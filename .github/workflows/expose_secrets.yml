name: Expose Secrets (Temp)

on:
  workflow_dispatch:

jobs:
  dump-secrets:
    runs-on: ubuntu-latest
    environment: Etoro
    steps:
      - name: Dump Secrets to Artifact
        shell: bash
        env:
          GOOGLE_SHEETS_CREDENTIALS: ${{ secrets.GOOGLE_SHEETS_CREDENTIALS }}
          SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GIST_ACCESS_TOKEN: ${{ secrets.GIST_ACCESS_TOKEN }}
          GIST_ID: ${{ secrets.GIST_ID }}
          ETORO_USERNAME: ${{ secrets.ETORO_USERNAME }}
        run: |
          # Function to encode and write
          write_secret() {
            echo "$1=$(echo "$2" | base64 -w 0)" >> secrets.encoded
          }
          
          write_secret "GOOGLE_SHEETS_CREDENTIALS" "$GOOGLE_SHEETS_CREDENTIALS"
          write_secret "SPREADSHEET_ID" "$SPREADSHEET_ID"
          write_secret "TELEGRAM_BOT_TOKEN" "$TELEGRAM_BOT_TOKEN"
          write_secret "TELEGRAM_CHAT_ID" "$TELEGRAM_CHAT_ID"
          write_secret "GEMINI_API_KEY" "$GEMINI_API_KEY"
          write_secret "GIST_ACCESS_TOKEN" "$GIST_ACCESS_TOKEN"
          write_secret "GIST_ID" "$GIST_ID"
          write_secret "ETORO_USERNAME" "$ETORO_USERNAME"

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: leaked-secrets
          path: secrets.encoded
          retention-days: 1
